<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <title>Cartoon Sticker Booth</title>
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
    />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}"/>
</head>
<body class="app-bg d-flex flex-column">

<!-- Top Bar -->
<header class="d-flex justify-content-between align-items-center px-3 py-2 topbar">
    <div class="d-flex align-items-center gap-2">
        <img src="{{ url_for('static', filename='img/brand.svg') }}" alt="Brand" height="26"/>
        <span class="brand" id="txtBrand">Sticker Booth</span>
    </div>
    <div class="d-flex align-items-center gap-2">
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="manualToggle">
            <label class="form-check-label text-light" for="manualToggle" id="txtManual">Manual</label>
        </div>
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="autoFaceToggle" checked>
            <label class="form-check-label text-light" for="autoFaceToggle" id="txtAutoFace">Auto Face</label>
        </div>
        <button class="btn btn-outline-light btn-sm" id="resetBtn">Reset</button>
        <button class="btn btn-outline-light btn-sm" id="settingsBtn">Settings</button>
    </div>
</header>

<!-- Stage Panels -->
<main class="container-fluid flex-grow-1 d-flex flex-column align-items-center justify-content-center">

    <!-- Panel 1: Capture -->
    <section id="panelCapture" class="panel active">
        <video id="camera" autoplay playsinline></video>
        <canvas id="faceOverlay"></canvas>
        <div class="overlay">
            <div id="countdown" class="countdown d-none">5</div>
            <button id="captureBtn" class="cta-btn" data-i18n="startCapture">Start Capture</button>
            <small class="hint" id="autoHint">Auto capture in 5s</small>
        </div>
    </section>

    <!-- Panel 2: Preview/Cartoon -->
    <section id="panelPreview" class="panel">
        <div class="preview-wrap">
            <div class="orig-thumb">
                <canvas id="photoCanvas" class="d-none"></canvas>
                <div class="checkerboard">
                    <img id="origPreview" alt="Original"/>
                </div>
            </div>
            <div class="cartoon-main">
                <div id="processing" class="processing">
                    <div class="sketch"></div>
                    <p id="procText">Converting to cartoon…</p>
                    <button id="retryBtn" class="cta-btn outline d-none">Retry</button>
                </div>
                <div class="checkerboard d-none" id="cartoonWrap">
                    <img id="cartoonPreview" alt="Cartoon"/>
                </div>
                <div class="actions">
                    <button id="approveBtn" class="cta-btn primary" disabled>Approve</button>
                    <button id="retakeBtn" class="cta-btn outline">Retake</button>
                </div>

                <!-- Layout options -->
                <div class="layout-options">
                    <div class="row g-2 align-items-center">
                        <div class="col-auto">
                            <label class="form-label mb-0" id="txtShape">Shape</label>
                            <select id="shapeSelect" class="form-select form-select-sm">
                                <option value="circle">Circle</option>
                                <option value="square">Square</option>
                            </select>
                        </div>
                        <div class="col-auto">
                            <label class="form-label mb-0" id="txtBorder">Border</label>
                            <select id="borderSelect" class="form-select form-select-sm">
                                <option value="none">None</option>
                                <option value="thin">Thin</option>
                                <option value="medium">Medium</option>
                                <option value="thick">Thick</option>
                                <option value="dotted">Dotted</option>
                            </select>
                        </div>
                        <div class="col-auto">
                            <label class="form-label mb-0" id="txtTheme">Theme</label>
                            <select id="themeSelect" class="form-select form-select-sm">
                                <option value="none">None</option>
                                <option value="gold">Gold Ring</option>
                                <option value="neon">Neon Glow</option>
                                <option value="brand">Brand Color</option>
                            </select>
                        </div>
                        <div class="col-auto">
                            <input id="brandColor" type="color" value="#FF4081" class="form-control form-control-sm"
                                   title="Brand color"/>
                        </div>
                        <div class="col-auto form-check">
                            <input class="form-check-input" type="checkbox" id="brandToggle">
                            <label class="form-check-label" for="brandToggle" id="txtBranding">Branding</label>
                        </div>
                        <div class="col-auto">
                            <input id="brandText" class="form-control form-control-sm"
                                   placeholder="Brand text (optional)"/>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Panel 3: Print Preview -->
    <section id="panelPrint" class="panel">
        <div class="a4-mock">
            <img id="sheetPreview" alt="A4 Sheet"/>
        </div>
        <div class="actions">
            <button id="printBtn" class="cta-btn primary">Print Now</button>
            <button id="downloadPdfBtn" class="cta-btn outline">Download PDF</button>
            <button id="backToEditBtn" class="cta-btn outline">Back to Edit</button>
        </div>
    </section>

</main>

<!-- Toasts -->
<div id="toastHost"></div>

<!-- Settings Modal -->
<div class="modal fade" id="settingsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-light" style="border:1px solid rgba(255,255,255,0.1);">
            <div class="modal-header">
                <h5 class="modal-title" id="txtSettings">Settings</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row g-3">
                    <div class="col-6">
                        <label class="form-label" id="txtTimer">Countdown (seconds)</label>
                        <input type="number" id="timerInput" class="form-control" min="3" max="10" step="1" value="5">
                    </div>
                    <div class="col-6 d-flex align-items-end">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="soundToggle" checked>
                            <label class="form-check-label" for="soundToggle" id="txtSound">Countdown sound</label>
                        </div>
                    </div>
                    <div class="col-6">
                        <label class="form-label" id="txtLanguage">Language</label>
                        <select id="langSelect" class="form-select">
                            <option value="en">English</option>
                            <option value="ur">Roman Urdu</option>
                        </select>
                    </div>
                    <div class="col-6 d-flex align-items-end">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="kioskToggle">
                            <label class="form-check-label" for="kioskToggle" id="txtKiosk">Kiosk mode
                                (fullscreen)</label>
                        </div>
                    </div>
                </div>
                <!-- Camera controls -->
                <div class="col-12">
                    <hr class="border-secondary opacity-25">
                </div>
                <div class="col-12">
                    <label class="form-label">Camera</label>
                    <div class="d-flex gap-2">
                        <select id="cameraSelect" class="form-select">
                            <!-- Populated by JS: includes Front/Back shortcuts + physical devices -->
                        </select>
                        <button class="btn btn-outline-light" id="refreshCamerasBtn">Refresh</button>
                    </div>
                    <small class="text-secondary">Allow camera permission first to see device names.</small>
                </div>
                <div class="col-6">
                    <label class="form-label">Preferred resolution</label>
                    <select id="resolutionSelect" class="form-select">
                        <option value="auto" selected>Auto</option>
                        <option value="1280x720">HD 1280×720</option>
                        <option value="1920x1080">FHD 1920×1080</option>
                        <option value="2560x1440">QHD 2560×1440</option>
                        <option value="3840x2160">4K 3840×2160</option>
                    </select>
                </div>
                <div class="col-6 d-flex align-items-end">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="mirrorToggle" checked>
                        <label class="form-check-label" for="mirrorToggle">Mirror preview (front cam)</label>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button id="saveSettingsBtn" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS + App JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
